language: php

services:
  - docker

php:
  - '7.2'

git:
  depth: 1

before_install:
  - curl -Ls https://raw.githubusercontent.com/unb-libraries/dockworker/3.x/scripts/travis/init.sh | bash
  - composer install

script:
  - set -e
  - vendor/bin/dockworker local:build-test
  - vendor/unb-libraries/dockworker/scripts/kubectl/init.sh
  - vendor/bin/dockworker image:deploy $TRAVIS_BRANCH
  - vendor/bin/dockworker deployment:logs:check $TRAVIS_BRANCH

notifications:
  slack:
    rooms:
      secure: ZNP/WI2wyzLYINmCLXo7XqN8yFUIrqJkqmzh4j+2ErYPlJtSxv4afkJz+T9Tc5TRYKk19zQiscXeqgpom8OAwm+DyFnIwHWxWHEWd14EBjvVzZqHuziAoU0Yr9vqArrZ0uEpw4p7NFfCLVr9E5CejVR8vOPr57tpQvYZS2xwH34QHnvFTf2mnUhtzedKLYN0Utw/vAEfEKughEkUTVOWvSgtJvpBAusximOoeJlvWWkMVnmWSjWFNXuHITqn9MDiZQqURdDwFZyW5wA535I6lVuiDd5iZoygD5sFVee49OxWMcYzkaj/qbIa5tsdDAion3on1jjdQrlq7aHnv0/HrLRiDRexYTsrpsDK7WrBwKGOxtj+zvg3H24RM9eWqR5TLZkOE5TN/op/61f8tqpqA2h9xbOrRXbOK62iOS5vYduBk+XZEjNucSw1nDq/VJ+VJ4veShDVWsz4bY0bjwjX49T53ybmKGyAgpmJ7XBrXL+V+TMSXA+nBRrOp4HalzVBuKuWzUmuhy4NqJ8D/DKDSOV4v5vu/R4/SR1oop+ZvnN55vLd0Y3bVs9Foc+PIl7Ya9ZhfuXWEbs5ocaiNjwRK82qxnBXXJoQZ2yiigaOYXHZ7gI9JqUe1qYVR8bu6K52k1Trq9h29WY7oB16u3+fZk5kokfysj7aCSWU7kvmqp8=
    on_start: always
    on_success: always
